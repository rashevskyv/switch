---
permalink: /backup-nand.html
title: Резервное копирование NAND
author_profile: true
---
{% include toc title="Разделы" %}

**Строго не рекомендуется пропускать этот шаг!** Если у вас уже есть бекап, повторно его делать не обязательно. Однако, убедитесь, что ваш бекап полный (RAW, BOOT0\1, ключи)
{: .notice--danger}

Бекап и ключи у каждой консоли уникальны! Вы не сможете восстановить консоль, используя бекап другой приставки. Более того, после восстановления чужого бекапа вы получите брик, который восстановить получится только накатив собственный бекап. Подходите к этому вопросы ответственно. 
{: .notice--warning}

{% spoiler Видеоинструкция %}

{% include youtube.html id="RIuwYF7_LoI" start="400" %}
{: .text-center}
{: .notice--info}

{% endspoiler %}

## Что понадобится

* Установленный свежий {% include abbr/kefir_addr.txt %}
* Работающая microSD, с не менее чем 32 Гб свободного места, в формате exFAT (не обязательно при резервном копировании на ПК)
    * Не важно поддерживает ли уже ваш Switch exFAT или нет в самой прошивке, всё равно в гекате используйте карту в exFAT
	 * Да, потом, в ходе руководства, придется отформатировать её в FAT32. Либо используйте разные карты для бекапа и приставки

## Создание резервное копии

### Часть I - Резервное копирование NAND 

{% spoiler Способ I - С помощью hekate  %}

{% spoiler Часть I - делаем дамп внутренней памяти приставки (NAND) %}

Этот способ требует карты памяти с не менее чем 32-мя Гб свободного места. Если у вас нет таковой, но есть карта меньшего размера, бекап будет делаться по частям. После заполнения текущего объёма на карте на экране будет выведена информация о том, что вам необходимо перенести папку backup на ПК, затем вернуть карту в консоль и продолжить создание резервной копии. После того, как все части бекапа будут находиться в одной папке на компьютере, их нужно склеить, используя скрипт [joiner_scripts_for_windows_linux_macos.zip](https://github.com/CTCaer/hekate/releases/download/v4.2/joiner_scripts_for_windows_linux_macos.zip){:target="_blank"}. Этот способ рассматриваться подробно не будет. Он занимает **намного** больше времени. **Крайне рекомендуется использовать карту достаточного объема в формате exFAT, поскольку только так вы будете уверены в том, что ваш бекап полный и правильный!**
{: .notice--info}

1. Обновите {% include abbr/kefir_addr.txt %} по инструкции из репозитория, если не делали этого ранее
{% include inc/launch-hekate.txt %}
1. Перейдите в меню "**Tools**" -> "**Backup eMMC**"
1. Выберите "**eMMC RAW GPP**"
	* Дождитесь окончания резервного копирования
	* Резервное копирование занимает около 40 минут, в зависимости от скорости карты памяти
1. Нажмите кнопку "**Close**", чтобы вернуться в предыдущее меню

Если вы делали резервное копирование NAND на новой приставке, в NAND которой ещё не устанавливали игр, то архивирование резервной копии даст качественный результат
{: .notice--warning}

{% endspoiler %}

{% spoiler Часть II - делаем дамп загрузочных разделов (BOOT0/BOOT1) %}

{% include inc/launch-hekate.txt %}
1. Перейдите в меню "**Tools**" -> "**Backup eMMC**"
1. Выберите "**eMMC BOOT0 & BOOT1**"
1. Нажмите кнопку "**Close**", чтобы вернуться в предыдущее меню
{% endspoiler %}

{% endspoiler %}

{% spoiler Способ II - С помощью ПК %}

### Дамп NAND

Этот способ сложнее, чем предыдущий, но не требует наличия большой карты памяти. Скорость создания резервной копии таким способом будет не более 6МБ/с
{: .notice--info}

1. Выключите консоль
1. Вставьте карту памяти приставки в ПК
1. Убедитесь, что включили [отображение расширений файлов](https://customfw.xyz/file-extensions-windows){:target="_blank"}, если у вас Windows
1. Скопируйте **содержимое** папки `sample` из `.zip`-архива с [memloader](https://switchtools.sshnuke.net/){:target="_blank"} в **корень** вашей карты памяти
1. Верните карту памяти обратно в Switch
1. Скопируйте пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} в папку из которой передаёте их на Switch (или в папку `\bootloader\payloads` для запуска через hekate)
1. Запустите пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. На экране приставки выберите `ums_eMMC.ini` и запустите
	* Для перемещения по меню используйте клавиши (VOL-) и (VOL+), для выбора - (POWER)
	* Обратите внимание, что выбрали именно "ums_**eMMC**.ini"
	* Игнорируйте файлы названия которых начинаются с точки, если таковые будут присутствовать

	**ВНИМАНИЕ!!!** Если вы в процессе выполнения руководства увидите диалоговое окно, с предложением отформатировать диск - **нажмите отмена**!!
	{: .notice--danger}
	
	![]({{ base_path }}/images/screenshots/format.png) 
	{: .text-center}
	{: .notice--danger}
	
	![]({{ base_path }}/images/screenshots/format_mac.png)
	{: .text-center}
	{: .notice--danger}

	* Экран приставки останется чёрным 
	* У вас появится несколько новых дисков
	
**Выберите вашу операционную систему:**

{% spoiler Windows %}

## Что понадобится

* Свежая версия [TegraRcmGUI](https://github.com/eliboa/TegraRcmGUI/releases/latest){:target="_blank"}
* Свежая версия [HDD Raw Copy Tool](http://hddguru.com/software/HDD-Raw-Copy-Tool/HDDRawCopy1.10Portable.exe){:target="_blank"}

### Установка драйверов 

Если драйвера уже были установлены, пропустите эту часть

1. Запустите `TegraRcmGUI.exe` от имени Администратора 
1. Перейдите во вкладку `Settings` и нажмите "**Install Driver**"
1. Установите драйвер
1. После успешной установки драйвера закройте программу 

### Резервное копирование
	
1. Запустите "**Диспетчер устройств**", убедитесь, что там, в дереве "**Дисковые устройства**" появилось устройство с названием "**LINUX UMS DISK 0**"
	* Если такового там нет, 
		* удалите все устройства с восклицательным знаком (так же ставьте галочку на удалении драйверов)
		* удалите все устройства с меткой "**USB Download Gadget**".
		* После удаления устройств выберите "**Действия**" -> "**Обновить конфигурацию оборудования**" в диспетчере устройств
	* Если после всех манипуляций диск так и не появился, выключите Switch, перезагрузите ПК, переустановите драйвера и по новой запустите пейлоад `memloader.bin` с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. Запустите [HDD Raw Copy Tool](http://hddguru.com/software/HDD-Raw-Copy-Tool/HDDRawCopy1.10Portable.exe){:target="_blank"} от имени администратора
1. Выберите "**LINUX UMS DISK 0**" и нажмите "**Continue**"
1. Два раза кликните на надписи "**Double-click to open file**" и сохраните бекап с именем `rawnand`
    * Обратите внимание на строку "**Тип файла**", убедитесь что там установлено **Raw image**
1. Нажмите "**Continue**"
1. Нажмите "**START**", чтобы начать резервное копирование
1. Если всё прошло успешно, то дамп NAND появится в директории, которую вы указали. Сохраните его в надёжном месте!
{% endspoiler %}

{% spoiler macOS %}

1. Запустите программу Дисковая утилита, убедитесь, что там появился внешний диск с названием "Linux UMS disk 0 Media"
	* Если такового нет, то выключите Switch и по новой запустите пейлоад `memloader.bin` с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. В Дисковой утилите нажмите правой кнопкой мыши на пункте "Linux UMS disk 0 Media"
1. Выберите опцию "Образ из Linux UMS disk 0 Media" и укажите путь куда сохранить полученный файл
	* Процесс займёт какое-то время. 
	* Если вы хотите восстановить бэкап на ваше устройство, то выберите опцию "Восстановить...", а в появившемся окне нажмите кнопку "Образ..." и укажите путь до сохранённого файла.
1. Если всё прошло успешно, то дамп NAND появится в директории, которую вы указали. Сохраните его в надёжном месте!

{% endspoiler %}

### Дамп BOOT0/BOOT1

Делайте аналогичным способом, как делали **Дамп NAND**, но вместо "ums_**eMMC**.ini" выбирайте "ums_**boot0**.ini" для дампа BOOT0 и "ums_**boot1**.ini" для дампа BOOT1

{% endspoiler %}

### Часть II - Дампим ключи

{% spoiler На приставке, прошитой через Fusée Gelée %}

1. Установите {% include abbr/kefir_addr.txt %} по инструкции, находящейся в его репозитории
    * Если уже делали, не нужно делать повторно
{% include inc/launch-hekate.txt %}
1. Перейдите в меню "**Payloads**"
1. Выберите "**Lockpick_RCM.bin**"
1. Выберите "**Dump keys from SysNAND**"
    * Навигация по меню осуществляется кнопками громкости, а выбор кнопкой (POWER)
	* Дампинг начнётся незамедлительно
		* Если ваша прошивка 8.0.0 или выше, то после нажатия кнопки (POWER) приставка перезапустит программу из среды Sept. После перезапуска программы, нажмите (POWER) ещё раз. 
1. Нажмите (POWER), чтобы вернуться в главное меню программы 
<!-- 1. Выберите "**Power off**", чтобы выключить приставку -->

{% endspoiler %}

{% spoiler На приставке, прошитой через SX Core / SX Lite %}

Для дампа ключей на приставках, прошитых через SX Core / SX Lite с установленной в чип прошивкой от SX, нужно запускать hekate через Cleanup. Если же на вашем чипе стоит Spacecraft-NX, дамп ключей будет такой же как для пользователей Fusée Gelée. Узнать какая именно у вас прошивка на чипе очень просто. Выключите приставку и запустите её без карты памяти. Если вы увидите красную иконку карты памяти на весь экран, у вас прошивка от SX, если самолётик на белом фоне - Spacecraft. Выключите приставку, удерживая кнопку питания, пока не потухнет экран и верните карту памяти на место.
{: .notice--info}

1. Выключите приставку, удерживая 30 секунд кнопку питания 
1. Вставьте карту памяти приставки в ПК 
1. Переименуйте находящийся там файл `boot.dat` в `_boot.dat`
1. Скачайте [SX_OS 3.1.0](https://drive.google.com/file/d/1PZ7w1J5PAQf4CrUWfzfA1mVnCNeD13RP){:target="_blank"}
1. Поместите скачанный `boot.dat` в корень карты памяти с заменой
1. Включите консоль, удерживая кнопку повышения громкости, чтобы попасть в меню загрузчика SX OS
1. Перейдите в "**Options**" -> "**SX Core** / **SX Lite**", затем выберите "**Cleanup**" -> "**Continue**"
7. Перейдите в "**Payloads**" -> `payload.bin`”`, затем выберите "**Launch**". Должен загрузиться SysNAND.
{% include inc/launch-hekate.txt %}
1. Перейдите в меню "**Payloads**"
1. Выберите "**Lockpick_RCM.bin**"
1. Выберите "**Dump keys from SysNAND**"
    * Навигация по меню осуществляется кнопками громкости, а выбор кнопкой (POWER)
	* Дампинг начнётся незамедлительно
		* Если ваша прошивка 8.0.0 или выше, то после нажатия кнопки (POWER) приставка перезапустит программу из среды Sept. После перезапуска программы, нажмите (POWER) ещё раз. 
1. Нажмите (POWER), чтобы вернуться в главное меню программы 
1. Выберите "**Power off**", чтобы выключить приставку
1. Вставьте карту памяти приставки в ПК 
1. Удалите находящийся там файл `boot.dat`
1. Переименуйте находящийся там файл `_boot.dat` в `boot.dat`

{% endspoiler %}

### Часть IV - Перемещение резервной копии на ПК

1. Вставьте карту памяти консоли в ПК 
1. Перейдите в папку `sd:/switch` и скопируйте файлы `prod.keys` и `partialaes.keys` в ту же папку, в которую вы скопировали ваш бекап
	* Файла `partialaes.keys` может не быть. Это нормально
1. Переместите на ПК папку `backup` 
1. Заархивируйте папку `backup` и поместите в надёжное место
1. Удалите папку `backup` с карты памяти, если вы скопировали её, а не переместили	

В общем случае, бекап должен выглядить примерно так: <br><br>
![]({{ base_path }}/images/screenshots/backup.png) 
{: .text-center}
{: .notice--info}
	
## Восстановление резервной копии

Никогда не восстанавливайте чужой бекап на свою консоль! Восстановив чужой бекап вы получите брик. Если у вас при этом нет собственного бекапа, то брик будет не восстановимый. 
{: .notice--danger}

### Восстановление через hekate 

1. На ПК перейдите в папку со своими резервными копиями 
1. В папке `backup -> ID` создайте папку `restore` и переместите содержимое папки `ID` в папку `restore`
	* ID - код из 8-ми символов от "0" до "9" и от "a" до "f"
	* Если папок нет, например из-за того, что резервную копию делали через ПК, просто сделайте бекап чего-либо не большого (BOOT1, например) в гекате и папки появятся
	* В итоге все должно выглядеть примерно так: `/backup/ID/restore` <br><br>
	
	![]({{ base_path }}/images/screenshots/restore.png) 
	{: .text-center}
	{: .notice--info}	
1. Переместите папку `backup` в корень карты памяти вашей консоли
{% include inc/launch-hekate.txt %}
1. Перейдите в `Tools -> Restore` и выберите "**Restore eMMC"**
1. Выберите "**eMMC BOOT0 & BOOT1**" для восстановления BOOT0 и BOOT1
1. Выберите "**eMMC RAW GPP**" для восстановления RAW раздела
1. Для подтверждения нажмите (POWER)
1. Не забудьте удалить с карты памяти папку `backup` после окончания восстановления и проверки работоспособности консоли после восстановления

### Восстановление через ПК

Восстановление проводится ровно через те же самые программы, что и делалась резервная копия, за исключением того, что вы сперва выбираете файл резервной копии, а потом диск, на который она будет восстанавливаться

При проблемах с восстановлением или отсутствии бекапа можете попробовать [эту инструкцию](downgrade_fw){:target="_blank"}

___

[Закрыть страницу](javascript:window.close();)
{: .notice--success}